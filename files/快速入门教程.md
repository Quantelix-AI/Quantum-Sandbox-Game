# ğŸš€ å¿«é€Ÿå…¥é—¨æ•™ç¨‹ - 30åˆ†é’Ÿä¸Šæ‰‹æ¸¸æˆå¼€å‘

## ğŸ“š æ•™ç¨‹æ¦‚è§ˆ

æœ¬æ•™ç¨‹å°†å¸¦ä½ åœ¨30åˆ†é’Ÿå†…æ­å»ºæ¸¸æˆçš„åŸºç¡€æ¡†æ¶ï¼Œå®ç°ä¸€ä¸ªå¯è¿è¡Œçš„åŸå‹ã€‚

**ä½ å°†å­¦åˆ°ï¼š**
- âœ… é¡¹ç›®åˆå§‹åŒ–å’Œä¾èµ–å®‰è£…
- âœ… åˆ›å»ºç¬¬ä¸€ä¸ªæ¸¸æˆåœºæ™¯
- âœ… æ·»åŠ ç©å®¶è§’è‰²å’ŒåŸºç¡€æ§åˆ¶
- âœ… å®ç°ç®€å•çš„ç‰©ç†äº¤äº’
- âœ… é›†æˆAIç”Ÿæˆçš„NPCå¯¹è¯

**å‰ç½®çŸ¥è¯†ï¼š**
- åŸºç¡€çš„TypeScript/JavaScriptçŸ¥è¯†
- äº†è§£npm/yarnåŒ…ç®¡ç†
- åŸºæœ¬çš„å‘½ä»¤è¡Œæ“ä½œ

---

## ç¬¬ä¸€æ­¥ï¼šé¡¹ç›®åˆå§‹åŒ–ï¼ˆ5åˆ†é’Ÿï¼‰

### 1.1 åˆ›å»ºé¡¹ç›®ç›®å½•

```bash
mkdir my-sandbox-game
cd my-sandbox-game
npm init -y
```

### 1.2 å®‰è£…æ ¸å¿ƒä¾èµ–

```bash
# å®‰è£…PixiJSå’ŒMatter.js
npm install pixi.js matter-js

# å®‰è£…TypeScriptå’Œæ„å»ºå·¥å…·
npm install -D typescript vite @types/node

# å®‰è£…AI SDKï¼ˆå¦‚æœä½¿ç”¨ï¼‰
npm install openai
```

### 1.3 é…ç½®TypeScript

åˆ›å»º `tsconfig.json`ï¼š

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "jsx": "react",
    "strict": true,
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "allowSyntheticDefaultImports": true,
    "forceConsistentCasingInFileNames": true,
    "outDir": "./dist",
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

### 1.4 é…ç½®Vite

åˆ›å»º `vite.config.ts`ï¼š

```typescript
import { defineConfig } from 'vite';
import path from 'path';

export default defineConfig({
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    port: 3000,
  },
  build: {
    target: 'esnext',
  },
});
```

### 1.5 åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„

```bash
mkdir -p src/{core,entities,rendering,physics,ai,utils}
mkdir -p assets/{sprites,sounds}
```

### 1.6 åˆ›å»ºå…¥å£HTML

åˆ›å»º `index.html`ï¼š

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æˆ‘çš„æ²™ç›’æ¸¸æˆ</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #0a0a0a;
    }
    #game-container {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="game-container"></div>
  <script type="module" src="/src/main.ts"></script>
</body>
</html>
```

---

## ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ¸¸æˆå¼•æ“ï¼ˆ10åˆ†é’Ÿï¼‰

### 2.1 åˆ›å»ºå‘é‡å·¥å…·ç±»

åˆ›å»º `src/utils/Vector2.ts`ï¼š

```typescript
export class Vector2 {
  constructor(
    public x: number = 0,
    public y: number = 0
  ) {}

  add(v: Vector2): Vector2 {
    return new Vector2(this.x + v.x, this.y + v.y);
  }

  subtract(v: Vector2): Vector2 {
    return new Vector2(this.x - v.x, this.y - v.y);
  }

  multiply(scalar: number): Vector2 {
    return new Vector2(this.x * scalar, this.y * scalar);
  }

  distance(v: Vector2): number {
    const dx = this.x - v.x;
    const dy = this.y - v.y;
    return Math.sqrt(dx * dx + dy * dy);
  }

  normalize(): Vector2 {
    const len = Math.sqrt(this.x * this.x + this.y * this.y);
    return len > 0 ? new Vector2(this.x / len, this.y / len) : new Vector2();
  }
}
```

### 2.2 åˆ›å»ºæ¸¸æˆå¼•æ“æ ¸å¿ƒ

åˆ›å»º `src/core/GameEngine.ts`ï¼š

```typescript
import * as PIXI from 'pixi.js';
import Matter from 'matter-js';

export class GameEngine {
  private app: PIXI.Application;
  private physicsEngine: Matter.Engine;
  private lastTime: number = 0;
  private isRunning: boolean = false;

  constructor(container: HTMLElement) {
    // åˆå§‹åŒ–PixiJS
    this.app = new PIXI.Application({
      width: window.innerWidth,
      height: window.innerHeight,
      backgroundColor: 0x0a0a0a,
      antialias: true,
      resolution: window.devicePixelRatio || 1,
    });

    container.appendChild(this.app.view as HTMLCanvasElement);

    // åˆå§‹åŒ–Matter.jsç‰©ç†å¼•æ“
    this.physicsEngine = Matter.Engine.create({
      gravity: { x: 0, y: 0.5 }, // è‡ªå®šä¹‰é‡åŠ›
    });

    // çª—å£å¤§å°è°ƒæ•´
    window.addEventListener('resize', () => this.onResize());
    this.onResize();
  }

  private onResize(): void {
    const width = window.innerWidth;
    const height = window.innerHeight;
    this.app.renderer.resize(width, height);
  }

  public start(): void {
    if (this.isRunning) return;
    
    this.isRunning = true;
    this.lastTime = performance.now();
    this.gameLoop();
  }

  private gameLoop = (): void => {
    if (!this.isRunning) return;

    const currentTime = performance.now();
    const deltaTime = Math.min((currentTime - this.lastTime) / 1000, 0.1);
    this.lastTime = currentTime;

    this.update(deltaTime);
    requestAnimationFrame(this.gameLoop);
  };

  private update(deltaTime: number): void {
    // æ›´æ–°ç‰©ç†å¼•æ“
    Matter.Engine.update(this.physicsEngine, deltaTime * 1000);
  }

  public getApp(): PIXI.Application {
    return this.app;
  }

  public getPhysicsEngine(): Matter.Engine {
    return this.physicsEngine;
  }

  public stop(): void {
    this.isRunning = false;
  }
}
```

---

## ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºç©å®¶è§’è‰²ï¼ˆ8åˆ†é’Ÿï¼‰

### 3.1 åˆ›å»ºå®ä½“åŸºç±»

åˆ›å»º `src/entities/Entity.ts`ï¼š

```typescript
import * as PIXI from 'pixi.js';
import Matter from 'matter-js';
import { Vector2 } from '../utils/Vector2';

export abstract class Entity {
  protected sprite: PIXI.Graphics;
  protected body: Matter.Body;
  protected position: Vector2;

  constructor(x: number, y: number) {
    this.position = new Vector2(x, y);
    this.sprite = new PIXI.Graphics();
    this.body = this.createPhysicsBody();
  }

  protected abstract createPhysicsBody(): Matter.Body;

  public update(deltaTime: number): void {
    // åŒæ­¥ç‰©ç†ä½ç½®åˆ°æ¸²æŸ“
    this.position.x = this.body.position.x;
    this.position.y = this.body.position.y;
    this.sprite.position.set(this.position.x, this.position.y);
    this.sprite.rotation = this.body.angle;
  }

  public getSprite(): PIXI.Graphics {
    return this.sprite;
  }

  public getBody(): Matter.Body {
    return this.body;
  }

  public abstract render(): void;
}
```

### 3.2 åˆ›å»ºç©å®¶ç±»

åˆ›å»º `src/entities/Player.ts`ï¼š

```typescript
import Matter from 'matter-js';
import { Entity } from './Entity';
import { Vector2 } from '../utils/Vector2';

export class Player extends Entity {
  private speed: number = 200;
  private jumpForce: number = 10;
  private isOnGround: boolean = false;
  private moveDirection: Vector2 = new Vector2();

  constructor(x: number, y: number) {
    super(x, y);
    this.render();
    this.setupControls();
  }

  protected createPhysicsBody(): Matter.Body {
    return Matter.Bodies.rectangle(
      this.position.x,
      this.position.y,
      40, // å®½åº¦
      60, // é«˜åº¦
      {
        restitution: 0.1,
        friction: 0.5,
        density: 0.001,
      }
    );
  }

  private setupControls(): void {
    const keys: { [key: string]: boolean } = {};

    window.addEventListener('keydown', (e) => {
      keys[e.key] = true;

      // è·³è·ƒ
      if (e.key === ' ' && this.isOnGround) {
        Matter.Body.applyForce(this.body, this.body.position, {
          x: 0,
          y: -this.jumpForce,
        });
      }
    });

    window.addEventListener('keyup', (e) => {
      keys[e.key] = false;
    });

    // ç§»åŠ¨é€»è¾‘
    const updateMovement = () => {
      this.moveDirection.x = 0;

      if (keys['a'] || keys['ArrowLeft']) {
        this.moveDirection.x = -1;
      }
      if (keys['d'] || keys['ArrowRight']) {
        this.moveDirection.x = 1;
      }

      requestAnimationFrame(updateMovement);
    };

    updateMovement();
  }

  public update(deltaTime: number): void {
    super.update(deltaTime);

    // åº”ç”¨æ°´å¹³ç§»åŠ¨
    if (this.moveDirection.x !== 0) {
      Matter.Body.setVelocity(this.body, {
        x: this.moveDirection.x * this.speed * deltaTime,
        y: this.body.velocity.y,
      });
    }

    // æ£€æµ‹æ˜¯å¦åœ¨åœ°é¢ä¸Šï¼ˆç®€å•ç‰ˆæœ¬ï¼‰
    this.isOnGround = Math.abs(this.body.velocity.y) < 0.1;
  }

  public render(): void {
    this.sprite.clear();
    this.sprite.beginFill(0x4ECDC4); // é’è‰²
    this.sprite.drawRect(-20, -30, 40, 60);
    this.sprite.endFill();
  }
}
```

---

## ç¬¬å››æ­¥ï¼šåˆ›å»ºæ¸¸æˆä¸–ç•Œï¼ˆ5åˆ†é’Ÿï¼‰

### 4.1 åˆ›å»ºåœ°é¢

åˆ›å»º `src/entities/Ground.ts`ï¼š

```typescript
import Matter from 'matter-js';
import { Entity } from './Entity';

export class Ground extends Entity {
  constructor(x: number, y: number, width: number, height: number) {
    super(x, y);
    this.createSprite(width, height);
  }

  protected createPhysicsBody(): Matter.Body {
    return Matter.Bodies.rectangle(
      this.position.x,
      this.position.y,
      800,
      50,
      {
        isStatic: true, // é™æ€ç‰©ä½“ï¼Œä¸å—é‡åŠ›å½±å“
      }
    );
  }

  private createSprite(width: number, height: number): void {
    this.sprite.clear();
    this.sprite.beginFill(0x2C3E50); // æ·±ç°è‰²
    this.sprite.drawRect(-width / 2, -height / 2, width, height);
    this.sprite.endFill();
  }

  public render(): void {
    // åœ°é¢ä¸éœ€è¦é‡å¤æ¸²æŸ“
  }
}
```

### 4.2 ç»„è£…æ¸¸æˆåœºæ™¯

åˆ›å»º `src/main.ts`ï¼š

```typescript
import { GameEngine } from './core/GameEngine';
import { Player } from './entities/Player';
import { Ground } from './entities/Ground';
import Matter from 'matter-js';

// åˆå§‹åŒ–æ¸¸æˆ
const container = document.getElementById('game-container')!;
const engine = new GameEngine(container);
const app = engine.getApp();
const physicsEngine = engine.getPhysicsEngine();

// åˆ›å»ºç©å®¶
const player = new Player(400, 200);
app.stage.addChild(player.getSprite());
Matter.World.add(physicsEngine.world, player.getBody());

// åˆ›å»ºåœ°é¢
const ground = new Ground(400, 550, 800, 50);
app.stage.addChild(ground.getSprite());
Matter.World.add(physicsEngine.world, ground.getBody());

// åˆ›å»ºä¸€äº›å¹³å°
const platforms = [
  new Ground(200, 400, 200, 20),
  new Ground(600, 350, 200, 20),
  new Ground(400, 250, 150, 20),
];

platforms.forEach((platform) => {
  app.stage.addChild(platform.getSprite());
  Matter.World.add(physicsEngine.world, platform.getBody());
});

// æ¸¸æˆå¾ªç¯
app.ticker.add(() => {
  const deltaTime = app.ticker.deltaMS / 1000;
  player.update(deltaTime);
});

// å¯åŠ¨æ¸¸æˆ
engine.start();

console.log('ğŸ® æ¸¸æˆå¯åŠ¨æˆåŠŸï¼');
console.log('æ§åˆ¶è¯´æ˜ï¼š');
console.log('- A/D æˆ– æ–¹å‘é”®å·¦å³ï¼šç§»åŠ¨');
console.log('- ç©ºæ ¼ï¼šè·³è·ƒ');
```

---

## ç¬¬äº”æ­¥ï¼šè¿è¡Œæ¸¸æˆï¼ˆ2åˆ†é’Ÿï¼‰

### 5.1 æ·»åŠ å¯åŠ¨è„šæœ¬

åœ¨ `package.json` ä¸­æ·»åŠ ï¼š

```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  }
}
```

### 5.2 å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000`ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ï¼š
- âœ… ä¸€ä¸ªå¯ä»¥å·¦å³ç§»åŠ¨çš„è§’è‰²
- âœ… å¯ä»¥è·³è·ƒçš„è§’è‰²
- âœ… åŸºç¡€çš„ç‰©ç†ç¢°æ’

**æ§åˆ¶è¯´æ˜ï¼š**
- A/D æˆ– æ–¹å‘é”® â† â†’ï¼šç§»åŠ¨
- ç©ºæ ¼é”®ï¼šè·³è·ƒ

---

## è¿›é˜¶ï¼šæ·»åŠ AIå¯¹è¯ç³»ç»Ÿï¼ˆå¯é€‰ï¼‰

### 6.1 åˆ›å»ºç®€å•çš„NPC

åˆ›å»º `src/entities/NPC.ts`ï¼š

```typescript
import { Entity } from './Entity';
import Matter from 'matter-js';

export class NPC extends Entity {
  private name: string;
  private dialogues: string[] = [];

  constructor(x: number, y: number, name: string) {
    super(x, y);
    this.name = name;
    this.render();
  }

  protected createPhysicsBody(): Matter.Body {
    return Matter.Bodies.rectangle(
      this.position.x,
      this.position.y,
      30,
      50,
      {
        isStatic: true,
      }
    );
  }

  public render(): void {
    this.sprite.clear();
    this.sprite.beginFill(0xF39C12); // æ©™è‰²
    this.sprite.drawRect(-15, -25, 30, 50);
    this.sprite.endFill();
    
    // æ·»åŠ åå­—æ ‡ç­¾ï¼ˆç®€åŒ–ç‰ˆï¼‰
    this.sprite.beginFill(0x000000, 0.7);
    this.sprite.drawRect(-25, -40, 50, 12);
    this.sprite.endFill();
  }

  public async talk(): Promise<string> {
    // è¿™é‡Œå¯ä»¥æ¥å…¥AI API
    const responses = [
      "ä½ å¥½ï¼Œæ—…è¡Œè€…ï¼",
      "ä»Šå¤©å¤©æ°”ä¸é”™ã€‚",
      "éœ€è¦å¸®åŠ©å—ï¼Ÿ",
      "å°å¿ƒå‰æ–¹çš„å±é™©ï¼"
    ];
    return responses[Math.floor(Math.random() * responses.length)];
  }
}
```

### 6.2 æ·»åŠ äº¤äº’æ£€æµ‹

åœ¨ `src/main.ts` ä¸­æ·»åŠ ï¼š

```typescript
// åˆ›å»ºNPC
const npc = new NPC(600, 500, "æ‘æ°‘è€å¼ ");
app.stage.addChild(npc.getSprite());
Matter.World.add(physicsEngine.world, npc.getBody());

// äº¤äº’æ£€æµ‹
window.addEventListener('keydown', async (e) => {
  if (e.key === 'e' || e.key === 'E') {
    const distance = Math.hypot(
      player.getBody().position.x - npc.getBody().position.x,
      player.getBody().position.y - npc.getBody().position.y
    );
    
    if (distance < 80) {
      const dialogue = await npc.talk();
      console.log(`${npc.name}: ${dialogue}`);
      // è¿™é‡Œå¯ä»¥æ˜¾ç¤ºUIå¯¹è¯æ¡†
      alert(dialogue);
    }
  }
});
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

æ­å–œï¼ä½ å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåŸºç¡€çš„æ¸¸æˆåŸå‹ã€‚æ¥ä¸‹æ¥å¯ä»¥ï¼š

### ç«‹å³å¯ä»¥å°è¯•çš„åŠŸèƒ½
1. **ç¾åŒ–è§†è§‰æ•ˆæœ**
   - æ·»åŠ èƒŒæ™¯å›¾
   - ä½¿ç”¨ç²¾çµå›¾ä»£æ›¿çº¯è‰²æ–¹å—
   - æ·»åŠ ç²’å­æ•ˆæœ

2. **æ‰©å±•ç©æ³•**
   - æ·»åŠ æ”¶é›†ç‰©å“ç³»ç»Ÿ
   - å®ç°ç®€å•çš„æˆ˜æ–—ç³»ç»Ÿ
   - æ·»åŠ åˆ†æ•°å’Œè®¡æ—¶å™¨

3. **ä¼˜åŒ–æ€§èƒ½**
   - å®ç°å¯¹è±¡æ± 
   - æ·»åŠ åˆ†å—åŠ è½½
   - ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½

### å‚è€ƒå®Œæ•´æ–‡æ¡£
- ğŸ“– [å®Œæ•´å¼€å‘æ–‡æ¡£](docs/æ¸¸æˆå¼€å‘å®Œæ•´æ–‡æ¡£.docx)
- ğŸ¤– [AIæç¤ºè¯åº“](docs/AIæç¤ºè¯åº“-å¿«é€Ÿå‚è€ƒ.md)
- ğŸ“š [é¡¹ç›®README](README.md)

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: æ¸¸æˆè¿è¡Œå¡é¡¿æ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥æ˜¯å¦æœ‰è¿‡å¤šçš„å®ä½“ï¼Œå°è¯•å®ç°å¯¹è±¡æ± å’Œè§†é”¥å‰”é™¤ã€‚

### Q: ç‰©ç†ç¢°æ’ä¸å‡†ç¡®ï¼Ÿ
A: è°ƒæ•´ç‰©ç†å¼•æ“çš„ç²¾åº¦è®¾ç½®ï¼Œæˆ–ä½¿ç”¨æ›´ç²¾ç¡®çš„ç¢°æ’å½¢çŠ¶ã€‚

### Q: å¦‚ä½•è°ƒè¯•ï¼Ÿ
A: ä½¿ç”¨Chrome DevToolsçš„Performanceæ ‡ç­¾é¡µåˆ†ææ€§èƒ½ç“¶é¢ˆã€‚

---

## ğŸ’¡ æ¨èå­¦ä¹ èµ„æº

- [PixiJSå®˜æ–¹æ•™ç¨‹](https://pixijs.io/guides/)
- [Matter.jsç¤ºä¾‹é›†](https://brm.io/matter-js/demo/)
- [TypeScriptæ‰‹å†Œ](https://www.typescriptlang.org/docs/)
- [Game Programming Patterns](https://gameprogrammingpatterns.com/)

---

**å®Œæˆæ—¶é—´**: â±ï¸ çº¦30åˆ†é’Ÿ  
**éš¾åº¦ç­‰çº§**: â­â­â˜†â˜†â˜† (åˆçº§)  
**æˆå°±è§£é”**: ğŸ† "æ¸¸æˆå¼€å‘æ–°æ‰‹"

ç¥ä½ ç¼–ç æ„‰å¿«ï¼ğŸ®âœ¨
